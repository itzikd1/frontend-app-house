<app-dashboard-summary-cards
  [cards]="dashboardCards"
  [activeFilter]="dashboardFilter"
  (cardClick)="setDashboardFilter.emit($event)"
></app-dashboard-summary-cards>

<!-- Tabs for tasks and categories -->
<app-tab-switcher
  [tabs]="[
    { id: 'tasks', label: 'Tasks' },
    { id: 'categories', label: 'Categories' }
  ]"
  [selectedTab]="selectedTab"
  (tabChange)="setTab($event)"
></app-tab-switcher>

<div class="tasks-filters">
  <div class="tag-filters">
    <button class="tag-btn" [class.active]="selectedCategory === 'all'" (click)="setCategory.emit('all')">All ({{ tasks.length }})</button>
    <ng-container *ngIf="categories && categories.length > 0">
      <button
        class="tag-btn"
        *ngFor="let category of categories"
        [class.active]="selectedCategory === category.id"
        (click)="setCategory.emit(category.id)"
      >
        {{ category.name }}
      </button>
    </ng-container>
  </div>
</div>

<div *ngIf="taskLoading">
  <app-loading-spinner [translationKey]="'loading.default'"></app-loading-spinner>
</div>
<div *ngIf="!taskLoading">
  <div *ngIf="taskError; else showTasks">
    <p class="error">{{ taskError }}</p>
  </div>
  <ng-template #showTasks>
    <div *ngIf="filteredTasks.length; else noTasks" class="tasks-list">
      <app-item-card
        *ngFor="let task of filteredTasks"
        [item]="task"
        [showCheckbox]="true"
        [completed]="task.completed"
        (toggleComplete)="onToggleTaskComplete(task, $event)"
        (edit)="openEditTaskDialog(task)"
        (delete)="deleteTask(task.id)"
      >
        <div class="task-meta-row">
          <span class="task-priority-badge" [ngClass]="task.priority && task.priority.toLowerCase()">{{ task.priority }}</span>
          <span *ngIf="task.dueDate" class="task-due-date">
            <mat-icon class="due-date-icon">error</mat-icon>
            <span [ngClass]="{'overdue': isOverdue(task.dueDate)}">{{ task.dueDate | date:'MMM d, yyyy' }}</span>
          </span>
          <span *ngIf="task.category && task.category.id !== 'None'" class="task-category-name">
            {{ task.category.name }}
          </span>
        </div>
      </app-item-card>
    </div>
    <ng-template #noTasks>
      <p>No tasks found.</p>
    </ng-template>
  </ng-template>
</div>

<button class="fab-btn" (click)="openAddTaskDialog()" aria-label="Add Task">
  <mat-icon>add</mat-icon>
</button>
